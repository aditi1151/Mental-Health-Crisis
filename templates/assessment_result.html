{% extends "layout.html" %}

{% block title %}- Assessment Results{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex align-items-center justify-content-between">
                    <h5 class="mb-0 font-weight-bold text-primary">{{ result.assessment_name }} Results</h5>
                    <span class="badge 
                    {% if 'minimal' in result.severity.lower() or 'low' in result.severity.lower() %}
                        bg-success
                    {% elif 'mild' in result.severity.lower() or 'moderate' in result.severity.lower() %}
                        bg-warning
                    {% else %}
                        bg-danger
                    {% endif %}
                    fs-6">
                        {{ result.severity }}
                    </span>
                </div>
                <div class="card-body">
                    <div class="row align-items-center mb-4">
                        <div class="col-md-6 mb-4 mb-md-0">
                    
                            <div class="results-chart-container">
                                <canvas id="results-chart"></canvas>
                                <div class="chart-score-container">
                                    <div id="score-text" class="chart-score">{{ result.score }}</div>
                                    <div class="chart-score-separator">/</div>
                                    <div id="max-score-text" class="chart-max-score">{{ result.max_score }}</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h4>Your Results Summary</h4>
                            <p>{{ result.interpretation }}</p>
                            
                            <div class="alert 
                            {% if 'minimal' in result.severity.lower() or 'low' in result.severity.lower() %}
                                alert-success
                            {% elif 'mild' in result.severity.lower() or 'moderate' in result.severity.lower() %}
                                alert-warning
                            {% else %}
                                alert-danger
                            {% endif %}
                            ">
                                <strong>Severity:</strong> {{ result.severity }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-top pt-4">
                        <h5>What Does This Mean?</h5>
                        <p>
                            {% if 'minimal' in result.severity.lower() or 'low' in result.severity.lower() %}
                            Your results indicate minimal symptoms. It's still important to maintain healthy coping mechanisms and self-care practices to support your mental wellbeing.
                            {% elif 'mild' in result.severity.lower() %}
                            Your results indicate mild symptoms. This is common and may benefit from some basic self-care strategies and monitoring. If symptoms persist or worsen, consider consulting a professional.
                            {% elif 'moderate' in result.severity.lower() %}
                            Your results indicate moderate symptoms. It's recommended to consider speaking with a mental health professional who can provide personalized guidance and support.
                            {% else %}
                            Your results indicate significant symptoms. It's strongly recommended that you reach out to a mental health professional who can provide proper evaluation and treatment options.
                            {% endif %}
                        </p>
                        
                        <div class="alert alert-info">
                            <h6 class="mb-2"><i class="fas fa-lightbulb me-2"></i> Based on your results, we've created personalized recommendations:</h6>
                            
                            {% if recommendations %}
                            <div class="recommendations-list mt-3">
                                {% for rec in recommendations[:3] %}
                                <div class="recommendation">
                                    <span class="recommendation-type {{ rec.type }}">{{ rec.type }}</span>
                                    <h6>{{ rec.title }}</h6>
                                    <p class="mb-1">{{ rec.description }}</p>
                                </div>
                                {% endfor %}
                                
                                {% if recommendations|length > 3 %}
                                <div class="text-center mt-3">
                                    <a href="{{ url_for('recommendations') }}" class="btn btn-sm btn-primary">
                                        View All Recommendations
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                            {% else %}
                            <p class="mb-0">No personalized recommendations available at this time.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('assessments') }}" class="btn btn-outline-primary">
                            <i class="fas fa-arrow-left me-2"></i> Back to Assessments
                        </a>
                        <a href="{{ url_for('dashboard') }}" class="btn btn-primary">
                            <i class="fas fa-home me-2"></i> Go to Dashboard
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="alert alert-warning">
                <h5><i class="fas fa-exclamation-triangle me-2"></i> Important Note</h5>
                <p>This assessment is a screening tool, not a diagnostic instrument. Results should be discussed with a qualified mental health professional for proper interpretation.</p>
                <p class="mb-0">If you're experiencing severe symptoms or thoughts of self-harm, please seek immediate professional help.</p>
            </div>
            
            <div class="card shadow">
                <div class="card-header py-3">
                    <h5 class="mb-0 font-weight-bold text-primary">Helpful Resources</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="d-flex">
                                <div class="me-3">
                                    <i class="fas fa-book fa-2x text-primary"></i>
                                </div>
                                <div>
                                    <h6>Educational Resources</h6>
                                    <p class="mb-0">Learn more about mental health and self-care strategies.</p>
                                    <a href="{{ url_for('resources') }}" class="btn btn-sm btn-link ps-0">View Resources</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="d-flex">
                                <div class="me-3">
                                    <i class="fas fa-comments fa-2x text-success"></i>
                                </div>
                                <div>
                                    <h6>Support Chat</h6>
                                    <p class="mb-0">Talk with our AI support assistant about your concerns.</p>
                                    <a href="{{ url_for('chatbot_page') }}" class="btn btn-sm btn-link ps-0">Start Chatting</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/assessments.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    
        initializeResultsVisualization(
            {{ result.score }}, 
            {{ result.max_score }}, 
            "{{ result.severity }}"
        );
    });
</script>
{% endblock %}
