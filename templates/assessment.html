{% extends "layout.html" %}

{% block title %}- Assessments{% endblock %}

{% block styles %}
<style>
    .option-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 10px;
    }
    
    .option-label {
        flex: 1;
        min-width: 120px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    {% if assessment %}
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h5 class="mb-0 font-weight-bold text-primary">{{ assessment.name }}</h5>
        </div>
        <div class="card-body">
            <div class="alert alert-info mb-4">
                <p class="mb-0"><i class="fas fa-info-circle me-2"></i> {{ assessment.instructions }}</p>
            </div>
            
            <div class="mb-4">
                <div class="progress assessment-progress">
                    <div id="assessment-progress" class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <p id="progress-text" class="text-center small mt-1">0 of {{ assessment.questions|length }} questions answered</p>
            </div>
            
            <form id="assessment-form" method="POST" action="{{ url_for('submit_assessment', assessment_id=assessment.id) }}">
                {% for question in assessment.questions %}
                <div id="question-{{ question.id }}" class="assessment-question">
                    <p class="mb-2"><strong>{{ loop.index }}. {{ question.text }}</strong></p>
                    
                    <div class="question-options" data-question-id="{{ question.id }}">
                        {% for option in question.options %}
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q{{ loop.parent.loop.index }}" id="q{{ loop.parent.loop.index }}_{{ loop.index }}" value="{{ option.value }}">
                            <label class="option-label form-check-label" for="q{{ loop.parent.loop.index }}_{{ loop.index }}">
                                {{ option.text }}
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
                
                <div class="mt-4 pt-3 border-top">
                    <div class="d-flex justify-content-between align-items-center">
                        <a href="{{ url_for('assessments') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i> Back to Assessments
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check me-2"></i> Submit Assessment
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
    <div class="card shadow">
        <div class="card-header py-3">
            <h5 class="mb-0 font-weight-bold text-primary">About This Assessment</h5>
        </div>
        <div class="card-body">
            <p>{{ assessment.description }}</p>
            
            <div class="mt-3 alert alert-warning">
                <h6 class="mb-2"><i class="fas fa-exclamation-triangle me-2"></i> Important</h6>
                <p class="mb-0">This assessment is a screening tool only and not a diagnostic instrument. Results should be discussed with a mental health professional for proper interpretation and guidance.</p>
            </div>
        </div>
    </div>
    
    {% else %}

    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="h3 mb-2">Mental Health Assessments</h1>
            <p class="lead">Complete validated screening tools to better understand your mental wellbeing</p>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Take an Assessment</h5>
                    <select id="assessment-selector" class="form-select">
                        <option value="">Choose an assessment...</option>
                        <option value="phq9">PHQ-9 (Depression)</option>
                        <option value="gad7">GAD-7 (Anxiety)</option>
                        <option value="pss">PSS (Stress)</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title"><i class="fas fa-cloud-rain text-primary me-2"></i> PHQ-9</h5>
                    <h6 class="card-subtitle mb-2 text-muted">Depression Screening</h6>
                    <p class="card-text">The Patient Health Questionnaire (PHQ-9) is a 9-question instrument used to screen for depression. It assesses the frequency and severity of depressive symptoms over the past two weeks.</p>
                    <a href="{{ url_for('take_assessment', assessment_id='phq9') }}" class="btn btn-outline-primary">Take PHQ-9</a>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title"><i class="fas fa-bolt text-warning me-2"></i> GAD-7</h5>
                    <h6 class="card-subtitle mb-2 text-muted">Anxiety Screening</h6>
                    <p class="card-text">The Generalized Anxiety Disorder scale (GAD-7) is a 7-question screening tool that helps identify symptoms of anxiety. It measures the frequency of anxiety symptoms over the past two weeks.</p>
                    <a href="{{ url_for('take_assessment', assessment_id='gad7') }}" class="btn btn-outline-primary">Take GAD-7</a>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title"><i class="fas fa-weight-hanging text-danger me-2"></i> PSS</h5>
                    <h6 class="card-subtitle mb-2 text-muted">Stress Screening</h6>
                    <p class="card-text">The Perceived Stress Scale (PSS) is a 10-question assessment that measures your perception of stress. It asks about feelings and thoughts during the last month to gauge stress levels.</p>
                    <a href="{{ url_for('take_assessment', assessment_id='pss') }}" class="btn btn-outline-primary">Take PSS</a>
                </div>
            </div>
        </div>
    </div>
    
    {% if past_results %}
    <div class="card shadow mt-4">
        <div class="card-header py-3">
            <h5 class="mb-0 font-weight-bold text-primary">Your Past Assessment Results</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Assessment</th>
                            <th>Score</th>
                            <th>Interpretation</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for result in past_results %}
                        <tr>
                            <td>{{ result.created_at.strftime('%b %d, %Y') }}</td>
                            <td>{{ result.assessment_type.name }}</td>
                            <td>{{ result.score }}</td>
                            <td>
                                <span class="badge 
                                {% if 'minimal' in result.interpretation.lower() or 'low' in result.interpretation.lower() %}
                                    bg-success
                                {% elif 'mild' in result.interpretation.lower() or 'moderate' in result.interpretation.lower() %}
                                    bg-warning
                                {% else %}
                                    bg-danger
                                {% endif %}
                                ">
                                    {{ result.interpretation.split('.')[0] }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    
    <div class="alert alert-warning mt-4">
        <h5><i class="fas fa-exclamation-triangle me-2"></i> Disclaimer</h5>
        <p>These assessments are screening tools, not diagnostic instruments. They are designed to help identify potential symptoms, not to replace professional evaluation. If your results indicate significant symptoms, please consult with a mental health professional.</p>
        <p class="mb-0">Your responses are private and secure. Results are stored in your account to help track changes over time and generate personalized recommendations.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
{% if assessment %}
<script src="{{ url_for('static', filename='js/assessments.js') }}"></script>
{% endif %}
{% endblock %}
